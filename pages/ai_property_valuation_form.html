<!DOCTYPE html>
<html lang="fr" dir="ltr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Estimation IA | EstimMa - Évaluation Immobilière Intelligente</title>
    <link rel="stylesheet" href="../css/main.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<script type="module" src="https://static.rocket.new/rocket-web.js?_cfg=https%3A%2F%2Festimma5821back.builtwithrocket.new&_be=https%3A%2F%2Fapplication.rocket.new&_v=0.1.5"></script>
</head>
<body class="bg-background min-h-screen">
    <!-- Header Navigation -->
    <header class="bg-surface shadow-soft sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <!-- Logo -->
                <div class="flex-shrink-0">
                    <a href="dashboard_home.html" class="flex items-center">
                        <svg class="h-8 w-8 text-primary" viewBox="0 0 32 32" fill="currentColor">
                            <path d="M16 2L3 14v16h8v-8h10v8h8V14L16 2zm0 4.83L24 14v12h-4v-8H12v8H8V14l8-7.17z"/>
                        </svg>
                        <span class="ml-2 text-xl font-heading font-bold text-text-primary">EstimMa</span>
                    </a>
                </div>

                <!-- Navigation Menu -->
                <nav class="hidden md:flex space-x-8">
                    <a href="dashboard_home.html" class="text-text-secondary hover:text-primary transition-colors duration-200">
                        Accueil
                    </a>
                    <a href="ai_property_valuation_form.html" class="text-primary font-medium">
                        Estimation IA
                    </a>
                    <a href="property_listings_management.html" class="text-text-secondary hover:text-primary transition-colors duration-200">
                        Annonces
                    </a>
                    <a href="market_analytics_heatmap.html" class="text-text-secondary hover:text-primary transition-colors duration-200">
                        Marché
                    </a>
                    <a href="agent_profile_services.html" class="text-text-secondary hover:text-primary transition-colors duration-200">
                        Profil Agent
                    </a>
                </nav>

                <!-- Language Toggle & User Menu -->
                <div class="flex items-center space-x-4">
                    <div class="flex bg-gray-100 rounded-lg p-1">
                        <button id="lang-fr" class="px-3 py-1 text-sm font-medium rounded-md bg-primary text-white transition-all duration-200">
                            FR
                        </button>
                        <button id="lang-ar" class="px-3 py-1 text-sm font-medium rounded-md text-gray-600 hover:text-primary transition-all duration-200">
                            العربية
                        </button>
                    </div>
                    
                    <!-- Mobile Menu Button -->
                    <button id="mobile-menu-btn" class="md:hidden p-2 rounded-md text-text-secondary hover:text-primary hover:bg-gray-100 transition-all duration-200">
                        <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Mobile Navigation Menu -->
            <div id="mobile-menu" class="md:hidden hidden border-t border-gray-200 py-4">
                <div class="space-y-2">
                    <a href="dashboard_home.html" class="block px-4 py-2 text-text-secondary hover:text-primary hover:bg-gray-50 rounded-md transition-all duration-200">
                        Accueil
                    </a>
                    <a href="ai_property_valuation_form.html" class="block px-4 py-2 text-primary bg-primary-50 rounded-md font-medium">
                        Estimation IA
                    </a>
                    <a href="property_listings_management.html" class="block px-4 py-2 text-text-secondary hover:text-primary hover:bg-gray-50 rounded-md transition-all duration-200">
                        Annonces
                    </a>
                    <a href="market_analytics_heatmap.html" class="block px-4 py-2 text-text-secondary hover:text-primary hover:bg-gray-50 rounded-md transition-all duration-200">
                        Marché
                    </a>
                    <a href="agent_profile_services.html" class="block px-4 py-2 text-text-secondary hover:text-primary hover:bg-gray-50 rounded-md transition-all duration-200">
                        Profil Agent
                    </a>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-1">
        <!-- Hero Section -->
        <section class="bg-gradient-to-br from-primary-50 to-accent-50 py-12">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="text-center">
                    <h1 class="text-4xl font-heading font-bold text-text-primary mb-4">
                        Estimation IA de votre bien
                    </h1>
                    <p class="text-xl text-text-secondary max-w-2xl mx-auto">
                        Obtenez une évaluation précise et instantanée de votre propriété grâce à notre intelligence artificielle spécialisée dans le marché marocain
                    </p>
                </div>
            </div>
        </section>

        <!-- Progress Indicator -->
        <section class="bg-surface border-b border-gray-200">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
                <div class="flex items-center justify-center space-x-4">
                    <div class="flex items-center">
                        <div class="w-8 h-8 bg-primary rounded-full flex items-center justify-center text-white text-sm font-medium">
                            1
                        </div>
                        <span class="ml-2 text-sm font-medium text-primary">Détails du bien</span>
                    </div>
                    <div class="w-16 h-1 bg-gray-200 rounded">
                        <div class="w-full h-1 bg-primary rounded"></div>
                    </div>
                    <div class="flex items-center">
                        <div class="w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center text-gray-500 text-sm font-medium">
                            2
                        </div>
                        <span class="ml-2 text-sm text-gray-500">Photos & Détails</span>
                    </div>
                    <div class="w-16 h-1 bg-gray-200 rounded"></div>
                    <div class="flex items-center">
                        <div class="w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center text-gray-500 text-sm font-medium">
                            3
                        </div>
                        <span class="ml-2 text-sm text-gray-500">Estimation</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Form Section -->
        <section class="py-12">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <!-- Form Content -->
                    <div class="lg:col-span-2">
                        <form id="valuation-form" class="space-y-8">
                            <!-- Essential Details Section -->
                            <div class="card">
                                <div class="flex items-center mb-6">
                                    <svg class="w-6 h-6 text-primary mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-4m-5 0H3m2 0h4M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
                                    </svg>
                                    <h2 class="text-2xl font-heading font-bold text-text-primary">Informations essentielles</h2>
                                </div>

                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <!-- Property Type -->
                                    <div>
                                        <label for="property-type" class="form-label">
                                            Type de bien *
                                            <button type="button" class="ml-1 text-gray-400 hover:text-gray-600" data-tooltip="Le type de propriété influence significativement l'estimation">
                                                <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                                </svg>
                                            </button>
                                        </label>
                                        <select id="property-type" name="property-type" required class="form-input">
                                            <option value>Sélectionnez le type</option>
                                            <option value="apartment">Appartement</option>
                                            <option value="villa">Villa</option>
                                            <option value="house">Maison</option>
                                            <option value="commercial">Commercial</option>
                                            <option value="land">Terrain</option>
                                        </select>
                                    </div>

                                    <!-- Location -->
                                    <div>
                                        <label for="location" class="form-label">
                                            Localisation *
                                            <button type="button" class="ml-1 text-gray-400 hover:text-gray-600" data-tooltip="La localisation est le facteur le plus important pour l'estimation">
                                                <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                                </svg>
                                            </button>
                                        </label>
                                        <input id="location" name="location" type="text" required class="form-input" placeholder="Ex: Casablanca, Maarif" autocomplete="address-level2" />
                                        <div id="location-suggestions" class="hidden absolute z-10 w-full bg-surface border border-gray-200 rounded-lg shadow-lg mt-1 max-h-48 overflow-y-auto">
                                            <!-- Location suggestions will be populated here -->
                                        </div>
                                    </div>

                                    <!-- Interior Surface -->
                                    <div>
                                        <label for="interior-surface" class="form-label">
                                            Surface intérieure (m²) *
                                        </label>
                                        <input id="interior-surface" name="interior-surface" type="number" required class="form-input" placeholder="120" min="10" max="2000" />
                                    </div>

                                    <!-- Exterior Surface -->
                                    <div>
                                        <label for="exterior-surface" class="form-label">
                                            Surface extérieure (m²)
                                        </label>
                                        <input id="exterior-surface" name="exterior-surface" type="number" class="form-input" placeholder="50" min="0" max="5000" />
                                    </div>

                                    <!-- Bedrooms -->
                                    <div>
                                        <label for="bedrooms" class="form-label">
                                            Nombre de chambres *
                                        </label>
                                        <div class="flex items-center space-x-3">
                                            <button type="button" id="bedrooms-minus" class="w-10 h-10 bg-gray-100 hover:bg-gray-200 rounded-lg flex items-center justify-center transition-colors duration-200">
                                                <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4"/>
                                                </svg>
                                            </button>
                                            <input id="bedrooms" name="bedrooms" type="number" required class="form-input text-center w-20" value="2" min="0" max="10" readonly />
                                            <button type="button" id="bedrooms-plus" class="w-10 h-10 bg-gray-100 hover:bg-gray-200 rounded-lg flex items-center justify-center transition-colors duration-200">
                                                <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                                                </svg>
                                            </button>
                                        </div>
                                    </div>

                                    <!-- Bathrooms -->
                                    <div>
                                        <label for="bathrooms" class="form-label">
                                            Nombre de salles de bain *
                                        </label>
                                        <div class="flex items-center space-x-3">
                                            <button type="button" id="bathrooms-minus" class="w-10 h-10 bg-gray-100 hover:bg-gray-200 rounded-lg flex items-center justify-center transition-colors duration-200">
                                                <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4"/>
                                                </svg>
                                            </button>
                                            <input id="bathrooms" name="bathrooms" type="number" required class="form-input text-center w-20" value="1" min="0" max="10" readonly />
                                            <button type="button" id="bathrooms-plus" class="w-10 h-10 bg-gray-100 hover:bg-gray-200 rounded-lg flex items-center justify-center transition-colors duration-200">
                                                <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                                                </svg>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Advanced Details Section -->
                            <div class="card" id="advanced-section">
                                <div class="flex items-center justify-between mb-6">
                                    <div class="flex items-center">
                                        <svg class="w-6 h-6 text-primary mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4"/>
                                        </svg>
                                        <h2 class="text-2xl font-heading font-bold text-text-primary">Détails avancés</h2>
                                    </div>
                                    <button type="button" id="toggle-advanced" class="text-primary hover:text-primary-600 font-medium">
                                        Afficher plus
                                    </button>
                                </div>

                                <div id="advanced-content" class="hidden space-y-6">
                                    <!-- Construction Year -->
                                    <div>
                                        <label for="construction-year" class="form-label">
                                            Année de construction
                                        </label>
                                        <div class="space-y-2">
                                            <input id="construction-year" name="construction-year" type="range" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer slider" min="1950" max="2024" value="2010" />
                                            <div class="flex justify-between text-sm text-gray-500">
                                                <span>1950</span>
                                                <span id="year-display" class="font-medium text-primary">2010</span>
                                                <span>2024</span>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Property Condition -->
                                    <div>
                                        <label class="form-label">État du bien</label>
                                        <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50 transition-colors duration-200">
                                                <input type="radio" name="condition" value="excellent" class="sr-only" />
                                                <div class="w-4 h-4 border-2 border-gray-300 rounded-full mr-3 flex-shrink-0"></div>
                                                <span class="text-sm">Excellent</span>
                                            </label>
                                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50 transition-colors duration-200">
                                                <input type="radio" name="condition" value="good" class="sr-only" checked />
                                                <div class="w-4 h-4 border-2 border-primary rounded-full mr-3 flex-shrink-0 bg-primary"></div>
                                                <span class="text-sm">Bon</span>
                                            </label>
                                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50 transition-colors duration-200">
                                                <input type="radio" name="condition" value="fair" class="sr-only" />
                                                <div class="w-4 h-4 border-2 border-gray-300 rounded-full mr-3 flex-shrink-0"></div>
                                                <span class="text-sm">Moyen</span>
                                            </label>
                                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50 transition-colors duration-200">
                                                <input type="radio" name="condition" value="poor" class="sr-only" />
                                                <div class="w-4 h-4 border-2 border-gray-300 rounded-full mr-3 flex-shrink-0"></div>
                                                <span class="text-sm">À rénover</span>
                                            </label>
                                        </div>
                                    </div>

                                    <!-- Amenities -->
                                    <div>
                                        <label class="form-label">Équipements</label>
                                        <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
                                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50 transition-colors duration-200">
                                                <input type="checkbox" name="amenities" value="parking" class="sr-only" />
                                                <div class="w-4 h-4 border-2 border-gray-300 rounded mr-3 flex-shrink-0"></div>
                                                <span class="text-sm">Parking</span>
                                            </label>
                                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50 transition-colors duration-200">
                                                <input type="checkbox" name="amenities" value="balcony" class="sr-only" />
                                                <div class="w-4 h-4 border-2 border-gray-300 rounded mr-3 flex-shrink-0"></div>
                                                <span class="text-sm">Balcon</span>
                                            </label>
                                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50 transition-colors duration-200">
                                                <input type="checkbox" name="amenities" value="elevator" class="sr-only" />
                                                <div class="w-4 h-4 border-2 border-gray-300 rounded mr-3 flex-shrink-0"></div>
                                                <span class="text-sm">Ascenseur</span>
                                            </label>
                                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50 transition-colors duration-200">
                                                <input type="checkbox" name="amenities" value="garden" class="sr-only" />
                                                <div class="w-4 h-4 border-2 border-gray-300 rounded mr-3 flex-shrink-0"></div>
                                                <span class="text-sm">Jardin</span>
                                            </label>
                                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50 transition-colors duration-200">
                                                <input type="checkbox" name="amenities" value="pool" class="sr-only" />
                                                <div class="w-4 h-4 border-2 border-gray-300 rounded mr-3 flex-shrink-0"></div>
                                                <span class="text-sm">Piscine</span>
                                            </label>
                                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50 transition-colors duration-200">
                                                <input type="checkbox" name="amenities" value="security" class="sr-only" />
                                                <div class="w-4 h-4 border-2 border-gray-300 rounded mr-3 flex-shrink-0"></div>
                                                <span class="text-sm">Sécurité</span>
                                            </label>
                                        </div>
                                    </div>

                                    <!-- Voice Input -->
                                    <div>
                                        <label class="form-label">Description vocale (optionnel)</label>
                                        <div class="flex items-center space-x-3">
                                            <button type="button" id="voice-btn" class="flex items-center px-4 py-2 bg-accent text-white rounded-lg hover:bg-accent-600 transition-colors duration-200">
                                                <svg class="w-5 h-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"/>
                                                </svg>
                                                Enregistrer
                                            </button>
                                            <span class="text-sm text-gray-500">Décrivez votre bien en arabe ou français</span>
                                        </div>
                                        <textarea id="voice-transcript" name="description" class="form-input mt-3" rows="3" placeholder="La transcription de votre description apparaîtra ici..."></textarea>
                                    </div>
                                </div>
                            </div>

                            <!-- Submit Button -->
                            <div class="flex justify-center">
                                <button type="submit" id="submit-btn" class="btn-primary px-8 py-4 text-lg">
                                    <span id="submit-text">Obtenir mon estimation</span>
                                    <svg id="loading-spinner" class="hidden animate-spin ml-2 h-5 w-5 text-white" fill="none" viewBox="0 0 24 24">
                                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"/>
                                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"/>
                                    </svg>
                                </button>
                            </div>
                        </form>
                    </div>

                    <!-- Image Upload Panel -->
                    <div class="lg:col-span-1">
                        <div class="card sticky top-24">
                            <div class="flex items-center mb-6">
                                <svg class="w-6 h-6 text-primary mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                                </svg>
                                <h3 class="text-xl font-heading font-bold text-text-primary">Photos du bien</h3>
                            </div>

                            <!-- Upload Area -->
                            <div id="upload-area" class="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-primary transition-colors duration-200 cursor-pointer">
                                <svg class="mx-auto h-12 w-12 text-gray-400 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
                                </svg>
                                <p class="text-gray-600 mb-2">Glissez vos photos ici ou</p>
                                <button type="button" class="text-primary hover:text-primary-600 font-medium">
                                    Parcourir les fichiers
                                </button>
                                <p class="text-xs text-gray-500 mt-2">PNG, JPG jusqu'à 10MB chacune</p>
                            </div>

                            <input type="file" id="file-input" multiple accept="image/*" class="hidden" />

                            <!-- Uploaded Images Preview -->
                            <div id="image-preview" class="mt-6 space-y-3 hidden">
                                <h4 class="font-medium text-text-primary">Photos ajoutées</h4>
                                <div id="preview-container" class="space-y-2">
                                    <!-- Preview items will be added here -->
                                </div>
                            </div>

                            <!-- Estimation Preview -->
                            <div id="estimation-preview" class="hidden mt-8 p-4 bg-primary-50 rounded-lg">
                                <h4 class="font-medium text-text-primary mb-3">Estimation en temps réel</h4>
                                <div class="text-2xl font-bold text-primary mb-2" id="price-estimate">
                                    1 250 000 DH
                                </div>
                                <div class="text-sm text-gray-600 mb-3">
                                    Confiance: <span class="font-medium text-success">85%</span>
                                </div>
                                <button type="button" class="w-full btn-outline text-sm py-2">
                                    Voir les détails
                                </button>
                            </div>

                            <!-- WhatsApp Share -->
                            <div class="mt-6 p-4 bg-green-50 rounded-lg">
                                <div class="flex items-center mb-3">
                                    <svg class="w-5 h-5 text-green-600 mr-2" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.885 3.488"/>
                                    </svg>
                                    <h4 class="font-medium text-green-800">Partage WhatsApp</h4>
                                </div>
                                <p class="text-sm text-green-700 mb-3">
                                    Partagez votre estimation avec vos contacts
                                </p>
                                <button type="button" class="w-full bg-green-600 text-white py-2 px-4 rounded-lg hover:bg-green-700 transition-colors duration-200 text-sm">
                                    Partager sur WhatsApp
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- JavaScript -->
    <script>
        // Mobile menu toggle
        const mobileMenuBtn = document.getElementById('mobile-menu-btn');
        const mobileMenu = document.getElementById('mobile-menu');

        mobileMenuBtn.addEventListener('click', () => {
            mobileMenu.classList.toggle('hidden');
        });

        // Language toggle
        const langFr = document.getElementById('lang-fr');
        const langAr = document.getElementById('lang-ar');

        langFr.addEventListener('click', () => {
            langFr.classList.add('bg-primary', 'text-white');
            langFr.classList.remove('text-gray-600');
            langAr.classList.remove('bg-primary', 'text-white');
            langAr.classList.add('text-gray-600');
            document.documentElement.setAttribute('lang', 'fr');
            document.documentElement.setAttribute('dir', 'ltr');
        });

        langAr.addEventListener('click', () => {
            langAr.classList.add('bg-primary', 'text-white');
            langAr.classList.remove('text-gray-600');
            langFr.classList.remove('bg-primary', 'text-white');
            langFr.classList.add('text-gray-600');
            document.documentElement.setAttribute('lang', 'ar');
            document.documentElement.setAttribute('dir', 'rtl');
        });

        // Room counter functionality
        function setupCounter(minusId, plusId, inputId, min = 0, max = 10) {
            const minusBtn = document.getElementById(minusId);
            const plusBtn = document.getElementById(plusId);
            const input = document.getElementById(inputId);

            minusBtn.addEventListener('click', () => {
                const currentValue = parseInt(input.value);
                if (currentValue > min) {
                    input.value = currentValue - 1;
                    updateEstimation();
                }
            });

            plusBtn.addEventListener('click', () => {
                const currentValue = parseInt(input.value);
                if (currentValue < max) {
                    input.value = currentValue + 1;
                    updateEstimation();
                }
            });
        }

        setupCounter('bedrooms-minus', 'bedrooms-plus', 'bedrooms');
        setupCounter('bathrooms-minus', 'bathrooms-plus', 'bathrooms');

        // Construction year slider
        const yearSlider = document.getElementById('construction-year');
        const yearDisplay = document.getElementById('year-display');

        yearSlider.addEventListener('input', (e) => {
            yearDisplay.textContent = e.target.value;
            updateEstimation();
        });

        // Advanced section toggle
        const toggleAdvanced = document.getElementById('toggle-advanced');
        const advancedContent = document.getElementById('advanced-content');

        toggleAdvanced.addEventListener('click', () => {
            const isHidden = advancedContent.classList.contains('hidden');
            if (isHidden) {
                advancedContent.classList.remove('hidden');
                toggleAdvanced.textContent = 'Masquer';
            } else {
                advancedContent.classList.add('hidden');
                toggleAdvanced.textContent = 'Afficher plus';
            }
        });

        // Radio button styling
        document.querySelectorAll('input[type="radio"]').forEach(radio => {
            radio.addEventListener('change', function() {
                // Reset all radio buttons in the same group
                document.querySelectorAll(`input[name="${this.name}"]`).forEach(r => {
                    const circle = r.parentElement.querySelector('div');
                    circle.classList.remove('bg-primary', 'border-primary');
                    circle.classList.add('border-gray-300');
                });
                
                // Style the selected radio button
                const circle = this.parentElement.querySelector('div');
                circle.classList.add('bg-primary', 'border-primary');
                circle.classList.remove('border-gray-300');
                
                updateEstimation();
            });
        });

        // Checkbox styling
        document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                const box = this.parentElement.querySelector('div');
                if (this.checked) {
                    box.classList.add('bg-primary', 'border-primary');
                    box.classList.remove('border-gray-300');
                    box.innerHTML = '<svg class="w-3 h-3 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg>';
                } else {
                    box.classList.remove('bg-primary', 'border-primary');
                    box.classList.add('border-gray-300');
                    box.innerHTML = '';
                }
                updateEstimation();
            });
        });

        // Location autocomplete
        const locationInput = document.getElementById('location');
        const locationSuggestions = document.getElementById('location-suggestions');
        
        const moroccanCities = [
            'Casablanca, Maarif', 'Casablanca, Ain Diab', 'Casablanca, Bourgogne',
            'Rabat, Agdal', 'Rabat, Hassan', 'Rabat, Hay Riad',
            'Marrakech, Gueliz', 'Marrakech, Hivernage', 'Marrakech, Targa',
            'Fès, Ville Nouvelle', 'Fès, Médina', 'Fès, Bensouda',
            'Tanger, Malabata', 'Tanger, Centre Ville', 'Tanger, Boubana'
        ];

        locationInput.addEventListener('input', (e) => {
            const query = e.target.value.toLowerCase();
            if (query.length < 2) {
                locationSuggestions.classList.add('hidden');
                return;
            }

            const filtered = moroccanCities.filter(city => 
                city.toLowerCase().includes(query)
            );

            if (filtered.length > 0) {
                locationSuggestions.innerHTML = filtered.map(city => 
                    `<div class="px-4 py-2 hover:bg-gray-50 cursor-pointer" onclick="selectLocation('${city}')">${city}</div>`
                ).join('');
                locationSuggestions.classList.remove('hidden');
            } else {
                locationSuggestions.classList.add('hidden');
            }
        });

        function selectLocation(city) {
            locationInput.value = city;
            locationSuggestions.classList.add('hidden');
            updateEstimation();
        }

        // File upload functionality
        const uploadArea = document.getElementById('upload-area');
        const fileInput = document.getElementById('file-input');
        const imagePreview = document.getElementById('image-preview');
        const previewContainer = document.getElementById('preview-container');

        uploadArea.addEventListener('click', () => fileInput.click());

        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('border-primary', 'bg-primary-50');
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('border-primary', 'bg-primary-50');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('border-primary', 'bg-primary-50');
            handleFiles(e.dataTransfer.files);
        });

        fileInput.addEventListener('change', (e) => {
            handleFiles(e.target.files);
        });

        function handleFiles(files) {
            Array.from(files).forEach(file => {
                if (file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        addImagePreview(file.name, e.target.result);
                    };
                    reader.readAsDataURL(file);
                }
            });
        }

        function addImagePreview(filename, src) {
            const previewItem = document.createElement('div');
            previewItem.className = 'flex items-center justify-between p-2 bg-gray-50 rounded-lg';
            previewItem.innerHTML = `
                <div class="flex items-center">
                    <img src="${src}" alt="${filename}" class="w-12 h-12 object-cover rounded">
                    <span class="ml-3 text-sm text-gray-700 truncate">${filename}</span>
                </div>
                <button type="button" class="text-red-500 hover:text-red-700" onclick="removeImage(this)">
                    <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                    </svg>
                </button>
            `;
            previewContainer.appendChild(previewItem);
            imagePreview.classList.remove('hidden');
        }

        function removeImage(button) {
            button.parentElement.remove();
            if (previewContainer.children.length === 0) {
                imagePreview.classList.add('hidden');
            }
        }

        // Voice input functionality
        const voiceBtn = document.getElementById('voice-btn');
        const voiceTranscript = document.getElementById('voice-transcript');
        let recognition;

        if ('webkitSpeechRecognition' in window) {
            recognition = new webkitSpeechRecognition();
            recognition.continuous = false;
            recognition.interimResults = false;
            recognition.lang = 'fr-FR';

            voiceBtn.addEventListener('click', () => {
                if (voiceBtn.textContent.includes('Enregistrer')) {
                    recognition.start();
                    voiceBtn.innerHTML = `
                        <svg class="w-5 h-5 mr-2 animate-pulse" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M12 14c1.66 0 2.99-1.34 2.99-3L15 5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.3-3c0 3-2.54 5.1-5.3 5.1S6.7 14 6.7 11H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c3.28-.48 6-3.3 6-6.72h-1.7z"/>
                        </svg>
                        Écoute...
                    `;
                    voiceBtn.disabled = true;
                }
            });

            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript;
                voiceTranscript.value = transcript;
                resetVoiceButton();
            };

            recognition.onerror = () => {
                resetVoiceButton();
            };

            recognition.onend = () => {
                resetVoiceButton();
            };
        } else {
            voiceBtn.style.display = 'none';
        }

        function resetVoiceButton() {
            voiceBtn.innerHTML = `
                <svg class="w-5 h-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z" />
                </svg>
                Enregistrer
            `;
            voiceBtn.disabled = false;
        }

        // Real-time estimation update
        function updateEstimation() {
            const propertyType = document.getElementById('property-type').value;
            const location = document.getElementById('location').value;
            const interiorSurface = document.getElementById('interior-surface').value;
            const bedrooms = document.getElementById('bedrooms').value;
            const bathrooms = document.getElementById('bathrooms').value;

            if (propertyType && location && interiorSurface && bedrooms && bathrooms) {
                // Simple estimation calculation (mock)
                let basePrice = 8000; // Price per m² in DH
                
                // Location multiplier
                if (location.includes('Casablanca')) basePrice *= 1.3;
                else if (location.includes('Rabat')) basePrice *= 1.2;
                else if (location.includes('Marrakech')) basePrice *= 1.1;
                
                // Property type multiplier
                if (propertyType === 'villa') basePrice *= 1.4;
                else if (propertyType === 'commercial') basePrice *= 1.6;
                
                const estimatedPrice = Math.round(basePrice * parseInt(interiorSurface));
                const formattedPrice = new Intl.NumberFormat('fr-MA', {
                    style: 'currency',
                    currency: 'MAD',
                    minimumFractionDigits: 0
                }).format(estimatedPrice).replace('MAD', 'DH');

                document.getElementById('price-estimate').textContent = formattedPrice;
                document.getElementById('estimation-preview').classList.remove('hidden');
            }
        }

        // Form submission
        const form = document.getElementById('valuation-form');
        const submitBtn = document.getElementById('submit-btn');
        const submitText = document.getElementById('submit-text');
        const loadingSpinner = document.getElementById('loading-spinner');

        form.addEventListener('submit', (e) => {
            e.preventDefault();
            
            // Show loading state
            submitText.textContent = 'Traitement en cours...';
            loadingSpinner.classList.remove('hidden');
            submitBtn.disabled = true;

            // Simulate AI processing
            setTimeout(() => {
                // Reset button state
                submitText.textContent = 'Obtenir mon estimation';
                loadingSpinner.classList.add('hidden');
                submitBtn.disabled = false;

                // Show success message or redirect
                alert('Estimation générée avec succès! Redirection vers les résultats...');
                // In a real app, you would redirect to results page
                // window.location.href = 'valuation_results.html';
            }, 3000);
        });

        // Initialize form
        document.addEventListener('DOMContentLoaded', () => {
            // Set initial radio button state
            document.querySelector('input[name="condition"][value="good"]').checked = true;
            const goodConditionCircle = document.querySelector('input[name="condition"][value="good"]').parentElement.querySelector('div');
            goodConditionCircle.classList.add('bg-primary', 'border-primary');
            goodConditionCircle.classList.remove('border-gray-300');

            // Add input event listeners for real-time estimation
            ['property-type', 'location', 'interior-surface', 'bedrooms', 'bathrooms'].forEach(id => {
                document.getElementById(id).addEventListener('input', updateEstimation);
                document.getElementById(id).addEventListener('change', updateEstimation);
            });
        });

        // Tooltip functionality
        document.querySelectorAll('[data-tooltip]').forEach(element => {
            element.addEventListener('mouseenter', (e) => {
                const tooltip = document.createElement('div');
                tooltip.className = 'tooltip show';
                tooltip.textContent = e.target.getAttribute('data-tooltip');
                tooltip.style.left = e.pageX + 'px';
                tooltip.style.top = (e.pageY - 40) + 'px';
                document.body.appendChild(tooltip);
                e.target.tooltip = tooltip;
            });

            element.addEventListener('mouseleave', (e) => {
                if (e.target.tooltip) {
                    e.target.tooltip.remove();
                    delete e.target.tooltip;
                }
            });
        });
    </script>
</body>
</html>