<!DOCTYPE html>
<html lang="fr" dir="ltr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Analyse du Marché & Heatmap | EstimMa - Estimation Immobilière IA</title>
    <link rel="stylesheet" href="../css/main.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<script type="module" src="https://static.rocket.new/rocket-web.js?_cfg=https%3A%2F%2Festimma5821back.builtwithrocket.new&_be=https%3A%2F%2Fapplication.rocket.new&_v=0.1.5"></script>
</head>
<body class="bg-background min-h-screen">
    <!-- Header Navigation -->
    <header class="bg-surface shadow-soft sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <!-- Logo -->
                <div class="flex-shrink-0">
                    <a href="dashboard_home.html" class="flex items-center">
                        <svg class="h-8 w-8 text-primary" viewBox="0 0 32 32" fill="currentColor">
                            <path d="M16 2L3 14v16h8v-8h10v8h8V14L16 2zm0 4.83L24 14v12h-4v-8H12v8H8V14l8-7.17z"/>
                        </svg>
                        <span class="ml-2 text-xl font-heading font-bold text-text-primary">EstimMa</span>
                    </a>
                </div>

                <!-- Desktop Navigation -->
                <nav class="hidden md:flex space-x-8">
                    <a href="dashboard_home.html" class="text-text-secondary hover:text-primary transition-colors duration-200">
                        Tableau de bord
                    </a>
                    <a href="ai_property_valuation_form.html" class="text-text-secondary hover:text-primary transition-colors duration-200">
                        Estimation IA
                    </a>
                    <a href="property_listings_management.html" class="text-text-secondary hover:text-primary transition-colors duration-200">
                        Annonces
                    </a>
                    <a href="market_analytics_heatmap.html" class="text-primary font-medium">
                        Analyse Marché
                    </a>
                    <a href="agent_profile_services.html" class="text-text-secondary hover:text-primary transition-colors duration-200">
                        Profil Agent
                    </a>
                </nav>

                <!-- Right Side Actions -->
                <div class="flex items-center space-x-4">
                    <!-- Language Toggle -->
                    <div class="flex bg-gray-100 rounded-lg p-1">
                        <button id="lang-fr" class="px-3 py-1 text-sm font-medium rounded-md bg-primary text-white transition-all duration-200">
                            FR
                        </button>
                        <button id="lang-ar" class="px-3 py-1 text-sm font-medium rounded-md text-gray-600 hover:text-primary transition-all duration-200">
                            العربية
                        </button>
                    </div>

                    <!-- Voice Search -->
                    <button id="voice-search" class="p-2 text-gray-400 hover:text-primary transition-colors duration-200 min-h-[44px] min-w-[44px] flex items-center justify-center">
                        <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"/>
                        </svg>
                    </button>

                    <!-- Mobile Menu Button -->
                    <button id="mobile-menu-btn" class="md:hidden p-2 text-gray-400 hover:text-primary transition-colors duration-200 min-h-[44px] min-w-[44px] flex items-center justify-center">
                        <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Mobile Navigation -->
            <div id="mobile-menu" class="md:hidden hidden border-t border-gray-200 py-4">
                <div class="space-y-2">
                    <a href="dashboard_home.html" class="block px-4 py-2 text-text-secondary hover:text-primary hover:bg-gray-50 rounded-md transition-all duration-200">
                        Tableau de bord
                    </a>
                    <a href="ai_property_valuation_form.html" class="block px-4 py-2 text-text-secondary hover:text-primary hover:bg-gray-50 rounded-md transition-all duration-200">
                        Estimation IA
                    </a>
                    <a href="property_listings_management.html" class="block px-4 py-2 text-text-secondary hover:text-primary hover:bg-gray-50 rounded-md transition-all duration-200">
                        Annonces
                    </a>
                    <a href="market_analytics_heatmap.html" class="block px-4 py-2 text-primary font-medium bg-primary-50 rounded-md">
                        Analyse Marché
                    </a>
                    <a href="agent_profile_services.html" class="block px-4 py-2 text-text-secondary hover:text-primary hover:bg-gray-50 rounded-md transition-all duration-200">
                        Profil Agent
                    </a>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-1">
        <!-- Page Header -->
        <div class="bg-gradient-to-r from-primary-50 to-accent-50 border-b border-gray-200">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
                <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between">
                    <div class="flex-1">
                        <h1 class="text-3xl font-heading font-bold text-text-primary mb-2">
                            Analyse du Marché Immobilier
                        </h1>
                        <p class="text-text-secondary">
                            Visualisez les tendances du marché et les prix par quartier au Maroc
                        </p>
                    </div>
                    
                    <!-- Export Actions -->
                    <div class="mt-4 lg:mt-0 flex space-x-3">
                        <button id="export-pdf" class="btn-outline">
                            <svg class="w-4 h-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                            </svg>
                            Exporter PDF
                        </button>
                        <button id="share-whatsapp" class="btn-primary">
                            <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.885 3.488"/>
                            </svg>
                            Partager
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab Navigation -->
        <div class="bg-surface border-b border-gray-200 sticky top-16 z-40">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex space-x-8 overflow-x-auto">
                    <button id="heatmap-tab" class="py-4 px-2 border-b-2 border-primary text-primary font-medium whitespace-nowrap">
                        Heatmap
                    </button>
                    <button id="trends-tab" class="py-4 px-2 border-b-2 border-transparent text-text-secondary hover:text-primary hover:border-gray-300 font-medium whitespace-nowrap transition-all duration-200">
                        Tendances
                    </button>
                    <button id="comparison-tab" class="py-4 px-2 border-b-2 border-transparent text-text-secondary hover:text-primary hover:border-gray-300 font-medium whitespace-nowrap transition-all duration-200">
                        Comparaisons
                    </button>
                </div>
            </div>
        </div>

        <!-- Heatmap View -->
        <div id="heatmap-view" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
            <!-- Controls -->
            <div class="bg-surface rounded-lg shadow-soft p-6 mb-6">
                <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-4">
                    <!-- City Selector -->
                    <div>
                        <label class="form-label">Ville</label>
                        <select id="city-selector" class="form-input">
                            <option value="casablanca">Casablanca</option>
                            <option value="rabat">Rabat</option>
                            <option value="marrakech">Marrakech</option>
                            <option value="fes">Fès</option>
                            <option value="tangier">Tanger</option>
                        </select>
                    </div>

                    <!-- Property Type Filter -->
                    <div>
                        <label class="form-label">Type de bien</label>
                        <select id="property-type" class="form-input">
                            <option value="all">Tous types</option>
                            <option value="apartment">Appartement</option>
                            <option value="house">Maison</option>
                            <option value="villa">Villa</option>
                            <option value="commercial">Commercial</option>
                        </select>
                    </div>

                    <!-- Time Period -->
                    <div>
                        <label class="form-label">Période</label>
                        <select id="time-period" class="form-input">
                            <option value="current">Actuel</option>
                            <option value="3months">3 derniers mois</option>
                            <option value="6months">6 derniers mois</option>
                            <option value="1year">1 an</option>
                        </select>
                    </div>

                    <!-- Price Range -->
                    <div>
                        <label class="form-label">Gamme de prix (DH/m²)</label>
                        <div class="flex items-center space-x-2">
                            <input type="range" id="price-range" min="5000" max="50000" value="25000" class="flex-1" />
                            <span id="price-value" class="text-sm font-medium text-text-primary">25 000</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Desktop Layout -->
            <div class="lg:grid lg:grid-cols-10 lg:gap-6">
                <!-- Heatmap Container -->
                <div class="lg:col-span-7">
                    <div class="bg-surface rounded-lg shadow-soft p-6 mb-6">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-heading font-semibold text-text-primary">
                                Carte des Prix - Casablanca
                            </h3>
                            <div class="flex items-center space-x-2">
                                <button id="zoom-in" class="p-2 text-gray-400 hover:text-primary transition-colors duration-200 min-h-[44px] min-w-[44px] flex items-center justify-center">
                                    <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                                    </svg>
                                </button>
                                <button id="zoom-out" class="p-2 text-gray-400 hover:text-primary transition-colors duration-200 min-h-[44px] min-w-[44px] flex items-center justify-center">
                                    <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 12H6"/>
                                    </svg>
                                </button>
                            </div>
                        </div>

                        <!-- Heatmap Canvas -->
                        <div class="relative bg-gray-50 rounded-lg overflow-hidden" style="height: 400px;">
                            <canvas id="heatmap-canvas" class="w-full h-full cursor-move"></canvas>
                            
                            <!-- Loading State -->
                            <div id="heatmap-loading" class="absolute inset-0 flex items-center justify-center bg-white bg-opacity-75">
                                <div class="text-center">
                                    <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-2"></div>
                                    <p class="text-sm text-text-secondary">Chargement de la carte...</p>
                                </div>
                            </div>
                        </div>

                        <!-- Legend -->
                        <div class="mt-4 flex items-center justify-between">
                            <div class="flex items-center space-x-4">
                                <span class="text-sm text-text-secondary">Prix/m² (DH)</span>
                                <div class="flex items-center space-x-1">
                                    <div class="w-4 h-4 bg-blue-200 rounded"></div>
                                    <span class="text-xs text-text-secondary">5K-15K</span>
                                </div>
                                <div class="flex items-center space-x-1">
                                    <div class="w-4 h-4 bg-yellow-300 rounded"></div>
                                    <span class="text-xs text-text-secondary">15K-25K</span>
                                </div>
                                <div class="flex items-center space-x-1">
                                    <div class="w-4 h-4 bg-orange-400 rounded"></div>
                                    <span class="text-xs text-text-secondary">25K-35K</span>
                                </div>
                                <div class="flex items-center space-x-1">
                                    <div class="w-4 h-4 bg-red-500 rounded"></div>
                                    <span class="text-xs text-text-secondary">35K+</span>
                                </div>
                            </div>
                            <div class="text-xs text-text-secondary">
                                Dernière mise à jour: 15 Jan 2025
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Analytics Panel -->
                <div class="lg:col-span-3">
                    <!-- Summary Cards -->
                    <div class="space-y-4 mb-6">
                        <div class="bg-surface rounded-lg shadow-soft p-4">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-text-secondary">Prix moyen</p>
                                    <p class="text-2xl font-bold text-text-primary">22 450 DH</p>
                                    <p class="text-xs text-text-secondary">par m²</p>
                                </div>
                                <div class="flex items-center text-success">
                                    <svg class="w-4 h-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 11l5-5m0 0l5 5m-5-5v12"/>
                                    </svg>
                                    <span class="text-sm font-medium">+5.2%</span>
                                </div>
                            </div>
                        </div>

                        <div class="bg-surface rounded-lg shadow-soft p-4">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-text-secondary">Vélocité marché</p>
                                    <p class="text-2xl font-bold text-text-primary">68%</p>
                                    <p class="text-xs text-text-secondary">taux d'activité</p>
                                </div>
                                <div class="flex items-center text-warning">
                                    <svg class="w-4 h-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4"/>
                                    </svg>
                                    <span class="text-sm font-medium">-1.8%</span>
                                </div>
                            </div>
                        </div>

                        <div class="bg-surface rounded-lg shadow-soft p-4">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-text-secondary">Nouvelles annonces</p>
                                    <p class="text-2xl font-bold text-text-primary">1 247</p>
                                    <p class="text-xs text-text-secondary">ce mois</p>
                                </div>
                                <div class="flex items-center text-success">
                                    <svg class="w-4 h-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 11l5-5m0 0l5 5m-5-5v12"/>
                                    </svg>
                                    <span class="text-sm font-medium">+12.4%</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Insights -->
                    <div class="bg-surface rounded-lg shadow-soft p-4">
                        <h4 class="font-heading font-semibold text-text-primary mb-3">Insights Rapides</h4>
                        <div class="space-y-3">
                            <div class="flex items-start space-x-2">
                                <div class="w-2 h-2 bg-primary rounded-full mt-2 flex-shrink-0"></div>
                                <p class="text-sm text-text-secondary">
                                    Les quartiers Maarif et Gauthier affichent les prix les plus élevés
                                </p>
                            </div>
                            <div class="flex items-start space-x-2">
                                <div class="w-2 h-2 bg-accent rounded-full mt-2 flex-shrink-0"></div>
                                <p class="text-sm text-text-secondary">
                                    Forte demande pour les appartements 2-3 chambres
                                </p>
                            </div>
                            <div class="flex items-start space-x-2">
                                <div class="w-2 h-2 bg-secondary rounded-full mt-2 flex-shrink-0"></div>
                                <p class="text-sm text-text-secondary">
                                    Tendance haussière prévue pour Q2 2025
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Data Table -->
            <div class="bg-surface rounded-lg shadow-soft overflow-hidden">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h3 class="text-lg font-heading font-semibold text-text-primary">
                        Données par Quartier
                    </h3>
                </div>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-text-secondary uppercase tracking-wider cursor-pointer hover:bg-gray-100">
                                    Quartier
                                </th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-text-secondary uppercase tracking-wider cursor-pointer hover:bg-gray-100">
                                    Prix moyen (DH/m²)
                                </th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-text-secondary uppercase tracking-wider cursor-pointer hover:bg-gray-100">
                                    Évolution
                                </th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-text-secondary uppercase tracking-wider cursor-pointer hover:bg-gray-100">
                                    Annonces actives
                                </th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-text-secondary uppercase tracking-wider cursor-pointer hover:bg-gray-100">
                                    Temps de vente
                                </th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            <tr class="hover:bg-gray-50">
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-text-primary">
                                    Maarif
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-text-primary font-data">
                                    35 200
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <span class="inline-flex items-center text-success text-sm">
                                        <svg class="w-3 h-3 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 11l5-5m0 0l5 5m-5-5v12"/>
                                        </svg>
                                        +8.5%
                                    </span>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-text-primary">
                                    142
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-text-primary">
                                    45 jours
                                </td>
                            </tr>
                            <tr class="hover:bg-gray-50">
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-text-primary">
                                    Gauthier
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-text-primary font-data">
                                    32 800
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <span class="inline-flex items-center text-success text-sm">
                                        <svg class="w-3 h-3 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 11l5-5m0 0l5 5m-5-5v12"/>
                                        </svg>
                                        +6.2%
                                    </span>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-text-primary">
                                    89
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-text-primary">
                                    38 jours
                                </td>
                            </tr>
                            <tr class="hover:bg-gray-50">
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-text-primary">
                                    Ain Diab
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-text-primary font-data">
                                    28 500
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <span class="inline-flex items-center text-success text-sm">
                                        <svg class="w-3 h-3 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 11l5-5m0 0l5 5m-5-5v12"/>
                                        </svg>
                                        +4.1%
                                    </span>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-text-primary">
                                    156
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-text-primary">
                                    52 jours
                                </td>
                            </tr>
                            <tr class="hover:bg-gray-50">
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-text-primary">
                                    Bourgogne
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-text-primary font-data">
                                    24 200
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <span class="inline-flex items-center text-warning text-sm">
                                        <svg class="w-3 h-3 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 13l-5 5m0 0l-5-5m5 5V6"/>
                                        </svg>
                                        -1.2%
                                    </span>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-text-primary">
                                    203
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-text-primary">
                                    67 jours
                                </td>
                            </tr>
                            <tr class="hover:bg-gray-50">
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-text-primary">
                                    Hay Hassani
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-text-primary font-data">
                                    18 900
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <span class="inline-flex items-center text-success text-sm">
                                        <svg class="w-3 h-3 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 11l5-5m0 0l5 5m-5-5v12"/>
                                        </svg>
                                        +2.8%
                                    </span>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-text-primary">
                                    287
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-text-primary">
                                    78 jours
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Trends View -->
        <div id="trends-view" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 hidden">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Price Evolution Chart -->
                <div class="bg-surface rounded-lg shadow-soft p-6">
                    <h3 class="text-lg font-heading font-semibold text-text-primary mb-4">
                        Évolution des Prix - 12 derniers mois
                    </h3>
                    <div class="h-64 bg-gray-50 rounded-lg flex items-center justify-center">
                        <svg class="w-full h-full" viewBox="0 0 400 200">
                            <!-- Chart Grid -->
                            <defs>
                                <pattern id="grid" width="40" height="20" patternUnits="userSpaceOnUse">
                                    <path d="M 40 0 L 0 0 0 20" fill="none" stroke="#e5e7eb" stroke-width="1"/>
                                </pattern>
                            </defs>
                            <rect width="100%" height="100%" fill="url(#grid)"/>
                            
                            <!-- Price Line -->
                            <polyline fill="none" stroke="#C4622D" stroke-width="3" points="20,150 60,140 100,135 140,130 180,125 220,120 260,115 300,110 340,105 380,100"/>
                            
                            <!-- Data Points -->
                            <circle cx="20" cy="150" r="4" fill="#C4622D"/>
                            <circle cx="60" cy="140" r="4" fill="#C4622D"/>
                            <circle cx="100" cy="135" r="4" fill="#C4622D"/>
                            <circle cx="140" cy="130" r="4" fill="#C4622D"/>
                            <circle cx="180" cy="125" r="4" fill="#C4622D"/>
                            <circle cx="220" cy="120" r="4" fill="#C4622D"/>
                            <circle cx="260" cy="115" r="4" fill="#C4622D"/>
                            <circle cx="300" cy="110" r="4" fill="#C4622D"/>
                            <circle cx="340" cy="105" r="4" fill="#C4622D"/>
                            <circle cx="380" cy="100" r="4" fill="#C4622D"/>
                            
                            <!-- Labels -->
                            <text x="20" y="190" text-anchor="middle" class="text-xs fill-gray-500">Jan</text>
                            <text x="100" y="190" text-anchor="middle" class="text-xs fill-gray-500">Mar</text>
                            <text x="180" y="190" text-anchor="middle" class="text-xs fill-gray-500">Mai</text>
                            <text x="260" y="190" text-anchor="middle" class="text-xs fill-gray-500">Jul</text>
                            <text x="340" y="190" text-anchor="middle" class="text-xs fill-gray-500">Sep</text>
                        </svg>
                    </div>
                </div>

                <!-- Market Velocity Chart -->
                <div class="bg-surface rounded-lg shadow-soft p-6">
                    <h3 class="text-lg font-heading font-semibold text-text-primary mb-4">
                        Vélocité du Marché
                    </h3>
                    <div class="h-64 bg-gray-50 rounded-lg flex items-center justify-center">
                        <svg class="w-full h-full" viewBox="0 0 400 200">
                            <!-- Chart Grid -->
                            <rect width="100%" height="100%" fill="url(#grid)"/>
                            
                            <!-- Velocity Bars -->
                            <rect x="30" y="120" width="30" height="60" fill="#2B5797" rx="2"/>
                            <rect x="80" y="100" width="30" height="80" fill="#2B5797" rx="2"/>
                            <rect x="130" y="90" width="30" height="90" fill="#2B5797" rx="2"/>
                            <rect x="180" y="80" width="30" height="100" fill="#C4622D" rx="2"/>
                            <rect x="230" y="70" width="30" height="110" fill="#C4622D" rx="2"/>
                            <rect x="280" y="85" width="30" height="95" fill="#2B5797" rx="2"/>
                            <rect x="330" y="95" width="30" height="85" fill="#2B5797" rx="2"/>
                            
                            <!-- Labels -->
                            <text x="45" y="195" text-anchor="middle" class="text-xs fill-gray-500">Jan</text>
                            <text x="145" y="195" text-anchor="middle" class="text-xs fill-gray-500">Mar</text>
                            <text x="245" y="195" text-anchor="middle" class="text-xs fill-gray-500">Mai</text>
                            <text x="345" y="195" text-anchor="middle" class="text-xs fill-gray-500">Jul</text>
                        </svg>
                    </div>
                </div>
            </div>

            <!-- Neighborhood Comparison -->
            <div class="mt-6 bg-surface rounded-lg shadow-soft p-6">
                <h3 class="text-lg font-heading font-semibold text-text-primary mb-4">
                    Comparaison par Quartier
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <div class="p-4 border border-gray-200 rounded-lg">
                        <div class="flex items-center justify-between mb-2">
                            <h4 class="font-medium text-text-primary">Maarif</h4>
                            <span class="text-success text-sm font-medium">+8.5%</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div class="bg-primary h-2 rounded-full" style="width: 85%"></div>
                        </div>
                        <p class="text-sm text-text-secondary mt-1">35 200 DH/m²</p>
                    </div>
                    
                    <div class="p-4 border border-gray-200 rounded-lg">
                        <div class="flex items-center justify-between mb-2">
                            <h4 class="font-medium text-text-primary">Gauthier</h4>
                            <span class="text-success text-sm font-medium">+6.2%</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div class="bg-secondary h-2 rounded-full" style="width: 78%"></div>
                        </div>
                        <p class="text-sm text-text-secondary mt-1">32 800 DH/m²</p>
                    </div>
                    
                    <div class="p-4 border border-gray-200 rounded-lg">
                        <div class="flex items-center justify-between mb-2">
                            <h4 class="font-medium text-text-primary">Ain Diab</h4>
                            <span class="text-success text-sm font-medium">+4.1%</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div class="bg-accent h-2 rounded-full" style="width: 68%"></div>
                        </div>
                        <p class="text-sm text-text-secondary mt-1">28 500 DH/m²</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- City Comparison View -->
        <div id="comparison-view" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 hidden">
            <div class="bg-surface rounded-lg shadow-soft p-6">
                <h3 class="text-lg font-heading font-semibold text-text-primary mb-6">
                    Comparaison entre Villes
                </h3>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Casablanca -->
                    <div class="text-center">
                        <img src="https://images.unsplash.com/photo-1539650116574-75c0c6d73f6e?q=80&w=2070&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D" alt="Casablanca" class="w-full h-32 object-cover rounded-lg mb-4" loading="lazy" onerror="this.src='https://images.pexels.com/photos/1134166/pexels-photo-1134166.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2'; this.onerror=null;" />
                        <h4 class="text-lg font-heading font-semibold text-text-primary mb-2">Casablanca</h4>
                        <div class="space-y-2">
                            <div class="flex justify-between">
                                <span class="text-sm text-text-secondary">Prix moyen:</span>
                                <span class="text-sm font-medium text-text-primary">22 450 DH/m²</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-sm text-text-secondary">Évolution:</span>
                                <span class="text-sm font-medium text-success">+5.2%</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-sm text-text-secondary">Annonces:</span>
                                <span class="text-sm font-medium text-text-primary">1 247</span>
                            </div>
                        </div>
                    </div>

                    <!-- Rabat -->
                    <div class="text-center">
                        <img src="https://images.pixabay.com/photo-2019/11/07/20/32/morocco-4609769_1280.jpg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2" alt="Rabat" class="w-full h-32 object-cover rounded-lg mb-4" loading="lazy" onerror="this.src='https://images.unsplash.com/photo-1539650116574-75c0c6d73f6e?q=80&w=2070&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D'; this.onerror=null;" />
                        <h4 class="text-lg font-heading font-semibold text-text-primary mb-2">Rabat</h4>
                        <div class="space-y-2">
                            <div class="flex justify-between">
                                <span class="text-sm text-text-secondary">Prix moyen:</span>
                                <span class="text-sm font-medium text-text-primary">19 800 DH/m²</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-sm text-text-secondary">Évolution:</span>
                                <span class="text-sm font-medium text-success">+3.8%</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-sm text-text-secondary">Annonces:</span>
                                <span class="text-sm font-medium text-text-primary">892</span>
                            </div>
                        </div>
                    </div>

                    <!-- Marrakech -->
                    <div class="text-center">
                        <img src="https://images.pexels.com/photos/2166559/pexels-photo-2166559.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2" alt="Marrakech" class="w-full h-32 object-cover rounded-lg mb-4" loading="lazy" onerror="this.src='https://images.pixabay.com/photo-2019/11/07/20/32/morocco-4609769_1280.jpg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2'; this.onerror=null;" />
                        <h4 class="text-lg font-heading font-semibold text-text-primary mb-2">Marrakech</h4>
                        <div class="space-y-2">
                            <div class="flex justify-between">
                                <span class="text-sm text-text-secondary">Prix moyen:</span>
                                <span class="text-sm font-medium text-text-primary">16 200 DH/m²</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-sm text-text-secondary">Évolution:</span>
                                <span class="text-sm font-medium text-success">+7.1%</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-sm text-text-secondary">Annonces:</span>
                                <span class="text-sm font-medium text-text-primary">634</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Comparison Chart -->
                <div class="mt-8">
                    <h4 class="text-md font-heading font-semibold text-text-primary mb-4">
                        Comparaison des Prix Moyens
                    </h4>
                    <div class="h-64 bg-gray-50 rounded-lg flex items-center justify-center">
                        <svg class="w-full h-full" viewBox="0 0 600 200">
                            <!-- Chart Grid -->
                            <rect width="100%" height="100%" fill="url(#grid)"/>
                            
                            <!-- Bars -->
                            <rect x="100" y="60" width="60" height="120" fill="#C4622D" rx="4"/>
                            <rect x="220" y="80" width="60" height="100" fill="#2B5797" rx="4"/>
                            <rect x="340" y="100" width="60" height="80" fill="#D4A574" rx="4"/>
                            <rect x="460" y="110" width="60" height="70" fill="#059669" rx="4"/>
                            
                            <!-- Values -->
                            <text x="130" y="50" text-anchor="middle" class="text-sm font-medium fill-gray-700">22.4K</text>
                            <text x="250" y="70" text-anchor="middle" class="text-sm font-medium fill-gray-700">19.8K</text>
                            <text x="370" y="90" text-anchor="middle" class="text-sm font-medium fill-gray-700">16.2K</text>
                            <text x="490" y="100" text-anchor="middle" class="text-sm font-medium fill-gray-700">14.5K</text>
                            
                            <!-- Labels -->
                            <text x="130" y="195" text-anchor="middle" class="text-sm fill-gray-600">Casablanca</text>
                            <text x="250" y="195" text-anchor="middle" class="text-sm fill-gray-600">Rabat</text>
                            <text x="370" y="195" text-anchor="middle" class="text-sm fill-gray-600">Marrakech</text>
                            <text x="490" y="195" text-anchor="middle" class="text-sm fill-gray-600">Fès</text>
                        </svg>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- JavaScript -->
    <script>
        // Tab switching functionality
        const heatmapTab = document.getElementById('heatmap-tab');
        const trendsTab = document.getElementById('trends-tab');
        const comparisonTab = document.getElementById('comparison-tab');
        const heatmapView = document.getElementById('heatmap-view');
        const trendsView = document.getElementById('trends-view');
        const comparisonView = document.getElementById('comparison-view');

        function switchTab(activeTab, activeView) {
            // Reset all tabs
            [heatmapTab, trendsTab, comparisonTab].forEach(tab => {
                tab.classList.remove('border-primary', 'text-primary');
                tab.classList.add('border-transparent', 'text-text-secondary');
            });
            
            // Reset all views
            [heatmapView, trendsView, comparisonView].forEach(view => {
                view.classList.add('hidden');
            });
            
            // Activate selected tab and view
            activeTab.classList.remove('border-transparent', 'text-text-secondary');
            activeTab.classList.add('border-primary', 'text-primary');
            activeView.classList.remove('hidden');
        }

        heatmapTab.addEventListener('click', () => switchTab(heatmapTab, heatmapView));
        trendsTab.addEventListener('click', () => switchTab(trendsTab, trendsView));
        comparisonTab.addEventListener('click', () => switchTab(comparisonTab, comparisonView));

        // Mobile menu toggle
        const mobileMenuBtn = document.getElementById('mobile-menu-btn');
        const mobileMenu = document.getElementById('mobile-menu');

        mobileMenuBtn.addEventListener('click', () => {
            mobileMenu.classList.toggle('hidden');
        });

        // Language toggle functionality
        const langFr = document.getElementById('lang-fr');
        const langAr = document.getElementById('lang-ar');

        langFr.addEventListener('click', () => {
            langFr.classList.add('bg-primary', 'text-white');
            langFr.classList.remove('text-gray-600');
            langAr.classList.remove('bg-primary', 'text-white');
            langAr.classList.add('text-gray-600');
            document.documentElement.setAttribute('lang', 'fr');
            document.documentElement.setAttribute('dir', 'ltr');
        });

        langAr.addEventListener('click', () => {
            langAr.classList.add('bg-primary', 'text-white');
            langAr.classList.remove('text-gray-600');
            langFr.classList.remove('bg-primary', 'text-white');
            langFr.classList.add('text-gray-600');
            document.documentElement.setAttribute('lang', 'ar');
            document.documentElement.setAttribute('dir', 'rtl');
        });

        // Heatmap Canvas Initialization
        const canvas = document.getElementById('heatmap-canvas');
        const ctx = canvas.getContext('2d');
        const loading = document.getElementById('heatmap-loading');

        function initializeHeatmap() {
            // Set canvas size
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
            
            // Simulate loading
            setTimeout(() => {
                loading.classList.add('hidden');
                drawHeatmap();
            }, 1500);
        }

        function drawHeatmap() {
            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw neighborhood zones with different colors based on price
            const zones = [
                { x: 50, y: 50, width: 80, height: 60, color: '#ef4444', label: 'Maarif' },
                { x: 150, y: 40, width: 70, height: 70, color: '#f97316', label: 'Gauthier' },
                { x: 240, y: 80, width: 90, height: 50, color: '#eab308', label: 'Ain Diab' },
                { x: 60, y: 130, width: 100, height: 80, color: '#22d3ee', label: 'Bourgogne' },
                { x: 180, y: 150, width: 120, height: 70, color: '#3b82f6', label: 'Hay Hassani' },
                { x: 320, y: 120, width: 80, height: 90, color: '#06b6d4', label: 'Sidi Maarouf' }
            ];
            
            zones.forEach(zone => {
                // Draw zone
                ctx.fillStyle = zone.color + '80'; // Add transparency
                ctx.fillRect(zone.x, zone.y, zone.width, zone.height);
                
                // Draw border
                ctx.strokeStyle = zone.color;
                ctx.lineWidth = 2;
                ctx.strokeRect(zone.x, zone.y, zone.width, zone.height);
                
                // Draw label
                ctx.fillStyle = '#1f2937';
                ctx.font = '12px Inter';
                ctx.textAlign = 'center';
                ctx.fillText(zone.label, zone.x + zone.width/2, zone.y + zone.height/2);
            });
        }

        // Controls functionality
        const citySelector = document.getElementById('city-selector');
        const propertyType = document.getElementById('property-type');
        const timePeriod = document.getElementById('time-period');
        const priceRange = document.getElementById('price-range');
        const priceValue = document.getElementById('price-value');

        // Update price range display
        priceRange.addEventListener('input', (e) => {
            const value = parseInt(e.target.value);
            priceValue.textContent = value.toLocaleString('fr-FR');
        });

        // Filter change handlers
        [citySelector, propertyType, timePeriod].forEach(control => {
            control.addEventListener('change', () => {
                loading.classList.remove('hidden');
                setTimeout(() => {
                    loading.classList.add('hidden');
                    drawHeatmap();
                }, 800);
            });
        });

        // Zoom functionality
        let zoomLevel = 1;
        const zoomIn = document.getElementById('zoom-in');
        const zoomOut = document.getElementById('zoom-out');

        zoomIn.addEventListener('click', () => {
            if (zoomLevel < 3) {
                zoomLevel += 0.2;
                canvas.style.transform = `scale(${zoomLevel})`;
            }
        });

        zoomOut.addEventListener('click', () => {
            if (zoomLevel > 0.5) {
                zoomLevel -= 0.2;
                canvas.style.transform = `scale(${zoomLevel})`;
            }
        });

        // Pan functionality
        let isPanning = false;
        let startX, startY, translateX = 0, translateY = 0;

        canvas.addEventListener('mousedown', (e) => {
            isPanning = true;
            startX = e.clientX - translateX;
            startY = e.clientY - translateY;
            canvas.style.cursor = 'grabbing';
        });

        canvas.addEventListener('mousemove', (e) => {
            if (!isPanning) return;
            
            translateX = e.clientX - startX;
            translateY = e.clientY - startY;
            canvas.style.transform = `scale(${zoomLevel}) translate(${translateX}px, ${translateY}px)`;
        });

        canvas.addEventListener('mouseup', () => {
            isPanning = false;
            canvas.style.cursor = 'move';
        });

        // Touch events for mobile
        canvas.addEventListener('touchstart', (e) => {
            e.preventDefault();
            const touch = e.touches[0];
            isPanning = true;
            startX = touch.clientX - translateX;
            startY = touch.clientY - translateY;
        });

        canvas.addEventListener('touchmove', (e) => {
            e.preventDefault();
            if (!isPanning) return;
            
            const touch = e.touches[0];
            translateX = touch.clientX - startX;
            translateY = touch.clientY - startY;
            canvas.style.transform = `scale(${zoomLevel}) translate(${translateX}px, ${translateY}px)`;
        });

        canvas.addEventListener('touchend', (e) => {
            e.preventDefault();
            isPanning = false;
        });

        // Voice search functionality
        const voiceSearch = document.getElementById('voice-search');
        let recognition;

        if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            recognition = new SpeechRecognition();
            recognition.continuous = false;
            recognition.interimResults = false;
            recognition.lang = 'fr-FR';

            voiceSearch.addEventListener('click', () => {
                recognition.start();
                voiceSearch.classList.add('text-primary');
            });

            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript.toLowerCase();
                console.log('Voice query:', transcript);
                
                // Process voice commands
                if (transcript.includes('casablanca')) {
                    citySelector.value = 'casablanca';
                    citySelector.dispatchEvent(new Event('change'));
                } else if (transcript.includes('rabat')) {
                    citySelector.value = 'rabat';
                    citySelector.dispatchEvent(new Event('change'));
                } else if (transcript.includes('marrakech')) {
                    citySelector.value = 'marrakech';
                    citySelector.dispatchEvent(new Event('change'));
                }
                
                if (transcript.includes('appartement')) {
                    propertyType.value = 'apartment';
                    propertyType.dispatchEvent(new Event('change'));
                } else if (transcript.includes('maison')) {
                    propertyType.value = 'house';
                    propertyType.dispatchEvent(new Event('change'));
                }
            };

            recognition.onend = () => {
                voiceSearch.classList.remove('text-primary');
            };
        } else {
            voiceSearch.style.display = 'none';
        }

        // Export functionality
        const exportPdf = document.getElementById('export-pdf');
        const shareWhatsapp = document.getElementById('share-whatsapp');

        exportPdf.addEventListener('click', () => {
            // Simulate PDF export
            const link = document.createElement('a');
            link.href = '#';
            link.download = 'rapport-marche-immobilier.pdf';
            link.click();
            
            // Show success message
            alert('Rapport PDF généré avec succès!');
        });

        shareWhatsapp.addEventListener('click', () => {
            const message = encodeURIComponent('Découvrez les dernières analyses du marché immobilier marocain sur EstimMa');
            const url = `https://wa.me/?text=${message}`;
            window.open(url, '_blank');
        });

        // Initialize heatmap on page load
        window.addEventListener('load', initializeHeatmap);
        window.addEventListener('resize', initializeHeatmap);
    </script>
</body>
</html>